name: Win - Deploy with action workflow
on: 
  workflow_dispatch:
    inputs:
      BRANCH:
        description: 'branch: the name of the branch "where" perform the workflow'
        required: true
      SEMVER:
        description: 'semver: in format major.minor.patch'
        required: true
      ENVIROMENT:
        description: "environment: the target environment where to execute the validatation or deployment"
        required: true

jobs:
  deploy:
    name: Deploy
    runs-on: windows-latest
    steps:
      - name: Set target artifact name
        id: target-artifact
        run: |
             echo "::set-output name=TARGET_ARTIFACT::$(echo myartifact_${{ github.event.inputs.BRANCH }}_${{ github.event.inputs.SEMVER }})"
   
      - name: Download artifact
        uses: ./.github/action/download
        with:
          artifact: ${{ steps.target-artifact.outputs.TARGET_ARTIFACT }}
          token: ${{ secrets.ACTIONS_TOKEN }}
             
      - name: Check downloaded artifact
        run: |
             Expand-Archive -LiteralPath "${{ steps.target-artifact.outputs.TARGET_ARTIFACT }}.zip" -DestinationPath .
             cat myartifact.txt
             
      - name: Call script for deploy/rollback
        run: |
            echo "Call script ${{ steps.download.conclusion }}"

      - name: Echo Variables
        if: ${{ always() }}
        run: |
             echo "${{ steps.target-artifact.outputs.TARGET_ARTIFACT }}"
             echo "${{ steps.max_id.outputs.MAX_ID }}"
             echo "${{ steps.url.outputs.URL }}"
